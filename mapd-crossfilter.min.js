function createDateAsUTC(n){return new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()))}!function(n){function e(n){function e(){var n=null,e=Number.MAX_SAFE_INTEGER;for(key in a)a[key].time<e&&(n=key,e=a[key].time);delete a[n]}function r(){return a={},l}function t(n,r,t,i,l){var c=Object.keys(a).length;if(!t){if(n in a)return a[n].time=f++,void u(n,void 0,!t,a[n].data,l);c>=o&&e()}return l.push(u.bind(this,n,i,!t)),s.queryAsync(n,!0,r,t,l)}function u(n,e,r,t,u){if(r){if(void 0===e)a[n]={time:f++,data:t};else{for(var i=t,l=0;l<e.length;l++)i=e[l](t);a[n]={time:f++,data:i}}u.pop()(a[n].data,u)}else if(void 0===e)u.pop()(t,u);else{for(var i=t,l=0;l<e.length;l++)i=e[l](t);u.pop()(i,u)}}function i(n,r,t,u){var i=Object.keys(a).length;if(!t){if(n in a)return a[n].time=f++,a[n].data;i>=o&&e()}var l=null;if(void 0===u)l=s.query(n,!0,r,t),t||(a[n]={time:f++,data:l});else{l=s.query(n,!0,r,t);for(var c=0;c<u.length;c++)l=u[c](l);t||(a[n]={time:f++,data:l})}return l}var l={query:i,queryAsync:t,emptyCache:r,setMaxCacheSize:function(n){o=n},setDataConnector:function(n){s=n}},o=10,a={},f=0,s=null;return s=n,l}function r(){function n(n){return p[typeof n]||p[A.call(n)]||(n?"object":"null")}function r(n,r,t){y=n,h=e(y),s=r,d=t;var u=y.getFields(s);return v={},u.forEach(function(n){v[n.name]={type:n.type,is_array:n.is_array,is_dict:n.is_dict}}),f}function t(){return v}function u(){var n="",e=!0;return $(c).each(function(r,t){null!=t&&""!=t&&(e||(n+=" AND "),e=!1,n+=t)}),n}function i(){function n(){return g=g==u?null:u,r}function e(){return c[u]}function r(n){return void 0==n||null==n?t():c[u]=n,r}function t(){return c[u]="",r}var r={filter:r,filterAll:t,getFilter:e,toggleTarget:n},u=c.length;return c.push(""),r}function l(r){function t(n){return arguments.length?(U=n,L):U}function u(){g=g==_?null:_}function i(){g==_&&(g=null)}function l(){return g==_}function a(n){return Y=n,L}function d(n){return w=n,L}function h(){return j}function p(){return c[_]}function A(n,e,r){return e="undefined"!=typeof e?e:!1,null==n?O():Array.isArray(n)&&!K?D(n,e,r):"function"==typeof n?filterFunction(n,e):T(n,e)}function S(e){var r=n(e);return"string"==r?"'"+e+"'":"date"==r?"TIMESTAMP(0) '"+e.toISOString().slice(0,19).replace("T"," ")+"'":e}function T(n,e){var r=Array.isArray(n);r||(n=[n]);for(var t="",u=0;u<n.length;u++){u>0&&(t+=" AND ");var i=S(n[u]);t+=G[u]?i+" = ANY "+X[u]:X[u]+" = "+i}return e="undefined"!=typeof e?e:!1,e?c[_]+=t:c[_]=t,L}function E(n,e){e="undefined"!=typeof e?e:!1,e?c[_]+=J+" like '%"+n+"%'":c[_]=J+" like '%"+n+"%'"}function b(n){append="undefined"!=typeof append?append:!1,append?c[_]+=J+" ilike '%"+n+"%'":c[_]=J+" ilike '%"+n+"%'"}function D(n,e,r){var t=Array.isArray(n[0]);t||(n=[n]),j=n;for(var u="",i=0;i<n.length;i++){1==r&&(W[i]=n[i]),i>0&&(u+=" AND ");var l=[S(n[i][0]),S(n[i][1])];u+=X[i]+" >= "+l[0]+" AND "+X[i]+" < "+l[1]}return e="undefined"!=typeof e?e:!1,e?c[_]+="("+u+")":c[_]="("+u+")",L}function N(n,e){var r=null==c[_]||""==c[_],t=!1;void 0!==e&&(t=e,1==t&&$(L).trigger("reranged"));var u=n.length-1;c[_]="(";for(var i=0;u>=i;i++){var l=n[i];A(l,!0,t),i!=u&&(V?c[_]+=" AND ":c[_]+=" OR ")}c[_]+=")";var o=null==c[_]||""==c[_];return r&&!o?$(this).trigger("filter-on"):!r&&o&&$(this).trigger("filter-clear"),L}function O(n){return(void 0==n||0==n)&&($(this).trigger("filter-clear"),W=[]),j=null,c[_]="",L}function C(n){var e="";if(w){for(var r=f.getDimensions(),t=[],u=0;u<r.length;u++)null!=r[u]&&t.push(r[u]);t=t.concat(Y);for(var i={},u=0;u<t.length;u++)t[u]in i||(i[t[u]]=null);t=[];for(key in i)t.push(key);e=t.join(",")}else e=Y.join(",");if(""!==e){n&&(e+=",rowid");for(var l="SELECT "+e+" FROM "+s,o="",a=0,g=0;g<c.length;g++)c[g]&&""!=c[g]&&(a>0&&(o+=" AND "),a++,o+=c[g]);if(""!=o&&(l+=" WHERE "+o),null!==k&&1>k){l+=o?" AND ":" WHERE ";var v=Math.floor(4294967296*k);l+=" rowid * 265445761 % 4294967296 < "+v}return l}}function k(n){return n||(k=null),k=n,L}function F(n,e,r){var t=C(!!r);return null==t?{}:null!=J?(t+=" ORDER BY "+J,n!==1/0&&(t+=" LIMIT "+n),z.query(t,!1)):(n!==1/0&&(t+=" LIMIT "+n),P=z.query(t,!1,r))}function M(n,e,r,t){var u=C(!!r);return null==u?{}:null!==J?(u+=" ORDER BY "+J,n!==1/0&&(u+=" LIMIT "+n),void 0!==e&&(u+=" OFFSET "+e),z.queryAsync(u,!1,r,void 0,t)):(n!==1/0&&(u+=" LIMIT "+n),void 0!==e&&(u+=" OFFSET "+e),r||t.push(B.bind(this)),z.queryAsync(u,!1,r,void 0,t))}function R(n,e){var r=C();return null==r?{}:null!=J?(r+=" ORDER BY "+J+" DESC LIMIT "+n,void 0!==e&&(r+=" OFFSET "+e),z.query(r,!1)):(r+=" LIMIT "+n,void 0!==e&&(r+=" OFFSET "+e),P=z.query(r,!1))}function I(n,e,r,t){var u=C();return null==u?{}:null!=J?(u+=" ORDER BY "+J+" DESC LIMIT "+n,void 0!==e&&(u+=" OFFSET "+e),z.queryAsync(u,!1,r,void 0,t)):(u+=" LIMIT "+n,void 0!==e&&(u+=" OFFSET "+e),t.push(B.bind(this)),z.queryAsync(u,!1,r,void 0,t))}function B(n,e){P=n,e.pop()(n,e)}function q(){function r(n){for(var e="",r=0,t=0;t<c.length;t++)if(t==_&&1!=V||U&&t==g||!c[t]||!(c[t].length>0)){if(t==_&&null!=n){var u="";r>0&&(u+=" AND "),r++;for(var i=!1,l=0;l<X.length;l++)if(null!==n[l]){var o=n[l].binBounds;1==j&&W.length>0&&(o=W[l]),l>0&&i&&(u+=" AND "),i=!0,u+="("+X[l]+" >= "+S(o[0])+" AND "+X[l]+" < "+S(o[1])+")"}i&&(e+=u)}}else r>0&&""!=e&&(e+=" AND "),r++,e+=c[t];return e}function t(e,r,t,i){var l="date"==n(r[0]);if(l){if(i){Z="auto"===i?u([r[0].getTime(),r[1].getTime()],t):i;var o="date_trunc("+Z+","+e+")";return o}var a="extract(epoch from "+e+")",f=.001*(r[1].getTime()-r[0].getTime()),s=(t/f).toFixed(9),c=r[0].getTime()/1e3,o="cast(("+a+" - "+c+") *"+s+" as int)";return o}var f=r[1]-r[0],s=(t/f).toFixed(9),o="cast(("+e+" - "+r[0]+") *"+s+" as int)";return o}function u(n,e){for(var r=[.001*n[0],.001*n[1]],t=r[1]-r[0],u=[{label:"second",numSeconds:1},{label:"minute",numSeconds:60},{label:"hour",numSeconds:3600},{label:"day",numSeconds:86400},{label:"week",numSeconds:604800},{label:"month",numSeconds:2592e3},{label:"quarter",numSeconds:10368e3},{label:"year",numSeconds:31536e3},{label:"decade",numSeconds:31536e4}],i=0;i<u.length;i++)if(t/u[i].numSeconds<e)return u[i].label;return"century"}function i(n){var e=null;B&&U&&(null!==g||g!==P)&&(null!==g&&""!==c[g]&&g!==_?$(R).trigger("targeted",[c[g]]):$(R).trigger("untargeted"),k(B),P=g);var u=null;if(null!==n){e="SELECT ";for(var i=0;i<X.length;i++)if(null!==n[i]){var l=j&&W.length>0?W[i]:n[i].binBounds,u=t(X[i],l,n[i].numBins,J);e+=u+" as key"+i.toString()+","}else if(J){var u=t(X[i],void 0,void 0,J);e+=u+" as key"+i.toString()+","}else e+=X[i]+" as key"+i.toString()+",";e+=I+" FROM "+s}else{for(var o="",i=0;i<X.length;i++)0!=i&&(o+=","),o+=G[i]?"UNNEST("+X[i]+")":X[i],o+=" as key"+i.toString();e="SELECT "+o+", "+I+" FROM "+s}var a=r(n);""!=a&&(e+=" WHERE "+a),e+=" GROUP BY ";for(var f=0;f<X.length;f++)0!=f&&(e+=", "),e+="key"+f.toString();if(null!==n)if("mapd"==y.getPlatform()){for(var v=" HAVING ",d=!1,i=0;i<n.length;i++)null!==n[i]&&(i>0&&d&&(v+=" AND "),d=!0,v+="key"+i.toString()+" >= 0 AND key"+i.toString()+" < "+n[i].numBins);d&&!J&&(e+=v)}else for(var i=0;i<n.length;i++)null!==n[i]&&(e+=" HAVING "+u+" >= 0 AND "+u+" < "+n[i].numBins);else"mapd"==y.getPlatform();return e}function l(n){return j=n,R}function o(n){if(!arguments.length){var e=[];if(L&&L.length)for(var r=0;r<L.length;r++)e.push(L[r].numBins);return e}if(Array.isArray(n)||(n=[n]),n.length!=L.length)throw"Num bins length must be same as bin params length";for(var t=0;t<n.length;t++)L[t].numBins=n[t];return R}function a(n){return arguments.length?(L=n,Array.isArray(L)||(L=[L]),R):L}function f(n){return Y=n,binCount=binCountIn,R}function v(n,e){var r=[],t=e.length;if(J){if(Q){var u=R.actualTimeBin(),i=1;switch(u){case"quarterday":u="hours",i=6;break;case"decade":u="years",i=10;break;case"century":u="years",i=100;break;case"millenium":u="years",i=1e3}var l=L.length;if(1==l){for(var o=null,a=[],f=0;t>f;f++){var s=e[f];if(o)for(var c=o.key0,g=moment(s.key0).utc().toDate(),v=moment(c).utc().add(i,u).toDate(),d=Math.abs(v-c);g>v;){var y=g-v;if(y>d/2){for(var m={key0:v},h=0;h<a.length;h++)m[a[h]]=0;r.push(m)}v=moment(v).utc().add(i,u).toDate()}else for(var p=Object.keys(s),h=0;h<p.length;h++)"key0"!==p[h]&&a.push(p[h]);r.push(s),o=s}return r}}return e}if(Q&&t>0){for(var A=!0,S=1,T=[],E=[],b=0;b<n.length;b++){if(null===n[b]){A=!1;break}S*=n[b].numBins,T.push(n[b].numBins),E.push(0==b?1:n[b].numBins*E[b-1])}if(E.reverse(),A){for(var D=T.length,N=Array.apply(null,Array(D)).map(Number.prototype.valueOf,0),p=Object.keys(e[0]),a=[],h=0;h<p.length;h++)p[h].startsWith("key")||a.push(p[h]);for(var O=0;S>O;O++){for(var s={},h=0;h<a.length;h++)s[a[h]]=0;for(var C=0;D>C;C++)s["key"+C]=N[C];r.push(s);for(var C=D-1;C>=0&&(N[C]+=1,!(N[C]<T[C]));C--)N[C]=0}for(var f=0;t>f;f++){for(var k=0,C=0;D>C;C++)k+=e[f]["key"+C]*E[C];r[k]=e[f]}return r}}return e}function d(e,r){r=v(e,r);var t=r.length;if(J)return r;for(var u=0;u<e.length;u++)if(null!==e[u]){var i=e[u].binBounds,l=e[u].numBins;j&&W.length>0&&(i=W[u]);var o="key"+u.toString(),a="date"==n(i[u]);if(a)for(var f=(i[1].getTime()-i[0].getTime())/l,s=i[0].getTime(),c=0;t>c;++c)r[c][o]=new Date(r[c][o]*f+s);else for(var f=(i[1]-i[0])/l,c=0;t>c;++c)r[c][o]=r[c][o]*f+i[0]}return r}function m(n){return en=n,R}function h(){return en=null,R}function p(){var n=$.extend([],L);n.length||(n=null);var e=i(n);e+=" ORDER BY ";for(var r=0;r<X.length;r++)r>0&&(e+=","),e+="key"+r.toString();return null!=n?w.query(e,nn,void 0,[d.bind(this,n)]):w.query(e,nn,void 0)}function A(n){var e=$.extend([],L);e.length||(e=null);var r=i(e);r+=" ORDER BY ";for(var t=0;t<X.length;t++)t>0&&(r+=","),r+="key"+t.toString();null!=e?w.queryAsync(r,nn,void 0,[d.bind(this,e)],n):w.queryAsync(r,nn,void 0,void 0,n)}function T(n,e){var r=i(null);if(r+=" ORDER BY ",en)r+=en+" DESC";else{for(var t=q.split(","),u=t.length,l=0;u-1>l;l++)r+=t[l]+" DESC,";r+=t[u-1]+" DESC"}return n!=1/0&&(r+=" LIMIT "+n),void 0!==e&&(r+=" OFFSET "+e),w.query(r,nn)}function E(n,e,r,t){var u=i(null);if(u+=" ORDER BY ",en)u+=en+" DESC";else{for(var l=q.split(","),o=l.length,a=0;o-1>a;a++)u+=l[a]+" DESC,";u+=l[o-1]+" DESC"}n!=1/0&&(u+=" LIMIT "+n),void 0!==e&&(u+=" OFFSET "+e),w.queryAsync(u,nn,void 0,void 0,t)}function b(){return k([{expression:"*",agg_mode:"count",name:"value"}]),R}function D(n){return k([{expression:n,agg_mode:"sum",name:"value"}]),R}function N(n){return k([{expression:n,agg_mode:"avg",name:"value"}]),R}function O(n){return k([{expression:n,agg_mode:"min",name:"value"}]),R}function C(n){return k([{expression:n,agg_mode:"max",name:"value"}]),R}function k(n){B=n,I="",q="";for(var e=n.length,r=0;e>r;r++){if(r>0&&(I+=",",q+=","),r==z&&null!=g&&g!=_&&""!=c[g])I+="AVG(CAST("+c[g]+" AS INT))";else{var t=n[r].agg_mode.toUpperCase();I+="COUNT"==t?n[r].filter?"COUNT(CASE WHEN "+n[r].filter+" THEN 1 END)":"COUNT(*)":n[r].filter?t+"(CASE WHEN "+n[r].filter+" THEN "+n[r].expression+" END)":t+"("+n[r].expression+")"}I+=" AS "+n[r].name,q+=n[r].name}return R}function F(n){return x=n,R}function M(n){for(var e="SELECT ",t=0;t<X.length;t++)t>0&&(e+=","),e+="COUNT(DISTINCT "+X[t]+") AS n",K&&(e+=t.toString());if(e+=" FROM "+s,!n){var u=jquery.extend([],L);u.length||(u=null);var i=r(u);""!=i&&(e+=" WHERE "+i)}if(K){for(var l=y.query(e)[0],o=[],t=0;t<X.length;t++){var a="n"+t.toString();o.push(l[a])}return o}return y.query(e)[0].n}var R={order:m,orderNatural:h,top:T,topAsync:E,all:p,allAsync:A,binParams:a,setBinParams:a,numBins:o,truncDate:f,reduceCount:b,reduceSum:D,reduceAvg:N,reduceMin:O,reduceMax:C,reduce:k,reduceMulti:k,setBoundByFilter:l,setTargetSlot:function(n){z=n},getTargetSlot:function(){return z},having:F,size:M,setEliminateNull:function(n){return nn=n,R},binByTimeUnit:function(n){return arguments.length?(J=n,R):J},actualTimeBin:function(){var n=$.extend([],L);if(n.length||(n=null),"auto"===J&&null!==n)for(var e=0;e<X.length;e++){var r=j&&W.length>0?W[e]:n[e].binBounds;Z=u([r[0].getTime(),r[1].getTime()],n[e].numBins)}return Z},writeFilter:r},I=null,B=null,q=null,x=null,L=null,j=!1,Y=null,w=e(y),P=null,z=0,J=null,Q=!0,Z=null,nn=!0,en=null;return H.push(R),b()}function x(){c[_]=null,m[_]=null}var L={type:"dimension",filter:A,filterExact:T,filterRange:D,filterAll:O,filterMulti:N,filterLike:E,filterILike:b,getFilter:h,getFilterString:p,projectOn:a,getProjectOn:function(){return Y},projectOnAllDimensions:d,getResultSet:function(){return P},samplingRatio:k,top:F,topAsync:M,bottom:R,bottomAsync:I,group:q,groupAll:o,toggleTarget:u,removeTarget:i,allowTargeted:t,isTargeting:l,dispose:x,remove:x,value:function(){return X},setDrillDownFilter:function(n){return V=n,L}},j=null,U=!0,_=c.length,H=[];c.push("");var Y=[],w=!1,W=[],P=null,G=[],V=!1,z=e(y),X=[],J=null,k=null,K=Array.isArray(r);K?X=r:null!==r&&(X=[r]),X.length>0&&(J="");for(var Q=0;Q<X.length;Q++)0!=Q&&(J+=", "),J+=X[Q];m.push(J);for(var Z=0;Z<X.length;Z++)X[Z]in v?G[Z]=v[X[Z]].is_array:G[Z]=!1;return L}function o(){function n(){for(var n="",e=0,r=0;r<c.length;r++)c[r]&&""!=c[r]&&(e>0&&(n+=" AND "),e++,n+=c[r]);return n}function r(e){var r="SELECT "+m+" FROM "+s;if(!e){var t=n();""!=t&&(r+=" WHERE "+t)}return r}function t(){return m="COUNT(*) as value",d}function u(n){return m="SUM("+n+") as value",d}function i(n){return m="AVG("+n+") as value",d}function l(n){return m="MIN("+n+") as value",d}function o(n){return m="MAX("+n+") as value",d}function a(n){m="";for(var e=n.length,r=0;e>r;r++){r>0&&(m+=",");var t=n[r].agg_mode.toUpperCase();m+="COUNT"==t?"COUNT(*)":t+"("+n[r].expression+")",m+=" AS "+n[r].name}return d}function f(n){var e=r(n);return h.query(e,!1,void 0,[function(n){return n[0].value}])}function g(n){var e=r();h.queryAsync(e,!1,void 0,[function(n){return n[0].value}],n)}function v(n){var e=r(n);return h.query(e,!1,void 0,[function(n){return n[0]}])}var d={reduceCount:t,reduceSum:u,reduceAvg:i,reduceMin:l,reduceMax:o,reduce:a,reduceMulti:a,value:f,valueAsync:g,values:v},m=null,h=e(y);return t()}function a(){var n="SELECT COUNT(*) as n FROM "+s;return h.query(n,!1,void 0,[function(n){return n[0].n}])}var f={type:"crossfilter",setData:r,filter:i,getColumns:t,dimension:l,groupAll:o,size:a,getFilter:function(){return c},getFilterString:u,getDimensions:function(){return m},getTable:function(){return s},getTableLabel:function(){return d}},s=null,c=[],g=null,v=null,d=null,y=null,m=[],h=null,p={undefined:"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error"},A=Object.prototype.toString;return 3==arguments.length?r(arguments[0],arguments[1],arguments[2]):f}r.version="1.3.11",n.resultCache=e,n.crossfilter=r}("undefined"!=typeof exports&&exports||this);