function createDateAsUTC(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()))}!function(e){function n(e){function n(){var e=null,n=Number.MAX_SAFE_INTEGER;for(key in a)a[key].time<n&&(e=key,n=a[key].time);delete a[e]}function r(){return a={},i}function t(e,r,t){var l=!1,i=null,c=null,g=null;r&&(l=r.eliminateNullRows?r.eliminateNullRows:!1,i=r.renderSpec?r.renderSpec:null,c=r.postProcessors?r.postProcessors:null,g=r.queryId?r.queryId:null);var v=Object.keys(a).length;if(!i){if(e in a)return a[e].time=s++,void u(e,null,!i,a[e].data,t);v>=o&&n()}t.push(u.bind(this,e,c,!i));var d={columnarResults:!0,eliminateNullRows:l,renderSpec:i,queryId:g};return f.query(e,d,t)}function u(e,n,r,t,u){if(r){if(n){for(var l=t,i=0;i<n.length;i++)l=n[i](t);a[e]={time:s++,data:l}}else a[e]={time:s++,data:t};u.pop()(a[e].data,u)}else if(n){for(var l=t,i=0;i<n.length;i++)l=n[i](t);u.pop()(l,u)}else u.pop()(t,u)}function l(e,r){var t=!1,u=null,l=null,i=null;r&&(t=r.eliminateNullRows?r.eliminateNullRows:!1,u=r.renderSpec?r.renderSpec:null,l=r.postProcessors?r.postProcessors:null,i=r.queryId?r.queryId:null);var c=Object.keys(a).length;if(!u){if(e in a)return a[e].time=s++,a[e].data;c>=o&&n()}var g=null,v={columnarResults:!0,eliminateNullRows:t,renderSpec:u,queryId:i};if(l){g=f.query(e,v);for(var d=0;d<l.length;d++)g=l[d](g);u||(a[e]={time:s++,data:g})}else g=f.query(e,v),u||(a[e]={time:s++,data:g});return g}var i={query:l,queryAsync:t,emptyCache:r,setMaxCacheSize:function(e){o=e},setDataConnector:function(e){f=e}},o=10,a={},s=0,f=null;return f=e,i}function r(){function e(e){return h[typeof e]||h[S.call(e)]||(e?"object":"null")}function r(e,r,t){m=e,p=n(m),f=r,d=t;var u=m.getFields(f);return v={},u.forEach(function(e){v[e.name]={type:e.type,is_array:e.is_array,is_dict:e.is_dict}}),s}function t(){return v}function u(){var e="",n=!0;return $(c).each(function(r,t){null!=t&&""!=t&&(n||(e+=" AND "),n=!1,e+=t)}),e}function l(){function e(){return g=g==u?null:u,r}function n(){return c[u]}function r(e){return void 0==e||null==e?t():c[u]=e,r}function t(){return c[u]="",r}var r={filter:r,filterAll:t,getFilter:n,toggleTarget:e},u=c.length;return c.push(""),r}function i(r){function t(e){return H=e,x}function u(){return H=null,M}function l(e){return arguments.length?(j=e,x):j}function i(){g=g==U?null:U}function a(){g==U&&(g=null)}function d(){return g==U}function p(e){return L=e,x}function h(e){return Y=e,x}function S(){return P}function A(){return c[U]}function E(e,n,r){return n="undefined"!=typeof n?n:!1,null==e?C():Array.isArray(e)&&!Q?D(e,n,r):"function"==typeof e?filterFunction(e,n):T(e,n)}function N(n){var r=e(n);return"string"==r?"'"+n+"'":"date"==r?"TIMESTAMP(0) '"+n.toISOString().slice(0,19).replace("T"," ")+"'":n}function T(e,n){var r=Array.isArray(e);r||(e=[e]);for(var t="",u=0;u<e.length;u++){u>0&&(t+=" AND ");var l=N(e[u]);t+=V[u]?l+" = ANY "+J[u]:J[u]+" = "+l}return n="undefined"!=typeof n?n:!1,n?c[U]+=t:c[U]=t,x}function b(e,n){n="undefined"!=typeof n?n:!1,n?c[U]+=K+" like '%"+e+"%'":c[U]=K+" like '%"+e+"%'"}function R(e){append="undefined"!=typeof append?append:!1,append?c[U]+=K+" ilike '%"+e+"%'":c[U]=K+" ilike '%"+e+"%'"}function D(e,n,r){var t=Array.isArray(e[0]);t||(e=[e]),P=e;for(var u="",l=0;l<e.length;l++){1==r&&(W[l]=e[l]),l>0&&(u+=" AND ");var i=[N(e[l][0]),N(e[l][1])];u+=J[l]+" >= "+i[0]+" AND "+J[l]+" < "+i[1]}return n="undefined"!=typeof n?n:!1,n?c[U]+="("+u+")":c[U]="("+u+")",x}function q(e,n){var r=null==c[U]||""==c[U],t=!1;void 0!==n&&(t=n,1==t&&$(x).trigger("reranged"));var u=e.length-1;c[U]="(";for(var l=0;u>=l;l++){var i=e[l];E(i,!0,t),l!=u&&(z?c[U]+=" AND ":c[U]+=" OR ")}c[U]+=")";var o=null==c[U]||""==c[U];return r&&!o?$(this).trigger("filter-on"):!r&&o&&$(this).trigger("filter-clear"),x}function C(e){return(void 0==e||0==e)&&($(this).trigger("filter-clear"),W=[]),P=null,c[U]="",x}function O(e){var n="";if(Y){for(var r=s.getDimensions(),t=[],u=0;u<r.length;u++)null!=r[u]&&t.push(r[u]);t=t.concat(L);for(var l={},u=0;u<t.length;u++)t[u]in l||(l[t[u]]=null);t=[];for(key in l)t.push(key);n=t.join(",")}else n=L.join(",");if(""!==n){e&&(n+=",rowid");for(var i="SELECT "+n+" FROM "+f,o="",a=0,g=0;g<c.length;g++)c[g]&&""!=c[g]&&(a>0&&(o+=" AND "),a++,o+=c[g]);if(""!=o&&(i+=" WHERE "+o),null!==k&&1>k){i+=o?" AND ":" WHERE ";var v=Math.floor(4294967296*k);i+=" MOD(rowid * 265445761, 4294967296) < "+v}return i}}function k(e){return e||(k=null),k=e,x}function I(e,n,r,t){var u=O(!!r);if(null==u)return{};H?u+=" ORDER BY "+H+" DESC":K&&(u+=" ORDER BY "+K+" DESC"),e!==1/0&&(u+=" LIMIT "+e),void 0!==n&&(u+=" OFFSET "+n);var l=!!t,i={eliminateNullRows:!1,renderSpec:r,postProcessors:null,queryId:U};return l?(r||t.push(F.bind(this)),X.queryAsync(u,i,t)):G=X.query(u,i)}function B(e,n,r,t){var u=O(!!r);if(null==u)return{};H?u+=" ORDER BY "+H+" ASC":K&&(u+=" ORDER BY "+K+"ASC"),e!==1/0&&(u+=" LIMIT "+e),void 0!==n&&(u+=" OFFSET "+n);var l=!!t,i={eliminateNullRows:!1,renderSpec:r,postProcessors:null,queryId:U};return l?(r||t.push(F.bind(this)),X.queryAsync(u,i,t)):G=X.query(u,i)}function F(e,n){G=e,n.pop()(e,n)}function M(){function r(e){for(var n="",r=0,t=0;t<c.length;t++)if(t==U&&1!=z||j&&t==g||!c[t]||!(c[t].length>0)){if(t==U&&null!=e){var u="";r>0&&(u+=" AND "),r++;for(var l=!1,i=0;i<J.length;i++)if(null!==e[i]){var o=e[i].binBounds;1==x&&W.length>0&&(o=W[i]),i>0&&l&&(u+=" AND "),l=!0,u+="("+J[i]+" >= "+N(o[0])+" AND "+J[i]+" < "+N(o[1])+")"}l&&(n+=u)}}else r>0&&""!=n&&(n+=" AND "),r++,n+=c[t];return n}function t(n,r,t,l){var i="date"==e(r[0]);if(i){if(l){K="auto"===l?u([r[0].getTime(),r[1].getTime()],t):l;var o="date_trunc("+K+","+n+")";return o}var a="extract(epoch from "+n+")",s=.001*(r[1].getTime()-r[0].getTime()),f=(t/s).toFixed(9),c=r[0].getTime()/1e3,o="cast(("+a+" - "+c+") *"+f+" as int)";return o}var s=r[1]-r[0],f=(t/s).toFixed(9),o="cast(("+n+" - "+r[0]+") *"+f+" as int)";return o}function u(e,n){for(var r=[.001*e[0],.001*e[1]],t=r[1]-r[0],u=[{label:"second",numSeconds:1},{label:"minute",numSeconds:60},{label:"hour",numSeconds:3600},{label:"day",numSeconds:86400},{label:"week",numSeconds:604800},{label:"month",numSeconds:2592e3},{label:"quarter",numSeconds:10368e3},{label:"year",numSeconds:31536e3},{label:"decade",numSeconds:31536e4}],l=0;l<u.length;l++)if(t/u[l].numSeconds<n)return u[l].label;return"century"}function l(e){var n=null;B&&j&&(null!==g||g!==L)&&(null!==g&&""!==c[g]&&g!==U?$(k).trigger("targeted",[c[g]]):$(k).trigger("untargeted"),q(B),L=g);var u=null;if(null!==e){n="SELECT ";for(var l=0;l<J.length;l++)if(null!==e[l]){var i=x&&W.length>0?W[l]:e[l].binBounds,u=t(J[l],i,e[l].numBins,G);n+=u+" as key"+l.toString()+","}else if(G){var u=t(J[l],void 0,void 0,G);n+=u+" as key"+l.toString()+","}else n+=J[l]+" as key"+l.toString()+",";n+=I+" FROM "+f}else{for(var o="",l=0;l<J.length;l++)0!=l&&(o+=","),o+=V[l]?"UNNEST("+J[l]+")":J[l],o+=" as key"+l.toString();n="SELECT "+o+", "+I+" FROM "+f}var a=r(e);""!=a&&(n+=" WHERE "+a),n+=" GROUP BY ";for(var s=0;s<J.length;s++)0!=s&&(n+=", "),n+="key"+s.toString();if(null!==e)if("mapd"==m.getPlatform()){for(var v=" HAVING ",d=!1,l=0;l<e.length;l++)null!==e[l]&&(l>0&&d&&(v+=" AND "),d=!0,v+="key"+l.toString()+" >= 0 AND key"+l.toString()+" < "+e[l].numBins);d&&!G&&(n+=v)}else for(var l=0;l<e.length;l++)null!==e[l]&&(n+=" HAVING "+u+" >= 0 AND "+u+" < "+e[l].numBins);else"mapd"==m.getPlatform();return n}function i(e){return x=e,k}function o(e){if(!arguments.length){var n=[];if(w&&w.length)for(var r=0;r<w.length;r++)n.push(w[r].numBins);return n}if(Array.isArray(e)||(e=[e]),e.length!=w.length)throw"Num bins length must be same as bin params length";for(var t=0;t<e.length;t++)w[t].numBins=e[t];return k}function a(e){return arguments.length?(w=e,Array.isArray(w)||(w=[w]),k):w}function s(e){return P=e,binCount=binCountIn,k}function v(e,n){var r=[],t=n.length;if(G){if(X){var u=k.actualTimeBin(),l=1;switch(u){case"quarterday":u="hours",l=6;break;case"decade":u="years",l=10;break;case"century":u="years",l=100;break;case"millenium":u="years",l=1e3}var i=w.length;if(1==i){for(var o=null,a=[],s=0;t>s;s++){var f=n[s];if(o)for(var c=o.key0,g=moment(f.key0).utc().toDate(),v=moment(c).utc().add(l,u).toDate(),d=Math.abs(v-c);g>v;){var m=g-v;if(m>d/2){for(var y={key0:v},p=0;p<a.length;p++)y[a[p]]=0;r.push(y)}v=moment(v).utc().add(l,u).toDate()}else for(var h=Object.keys(f),p=0;p<h.length;p++)"key0"!==h[p]&&a.push(h[p]);r.push(f),o=f}return r}}return n}if(X&&t>0){for(var S=!0,A=1,E=[],N=[],T=0;T<e.length;T++){if(null===e[T]){S=!1;break}A*=e[T].numBins,E.push(e[T].numBins),N.push(0==T?1:e[T].numBins*N[T-1])}if(N.reverse(),S){for(var b=E.length,R=Array.apply(null,Array(b)).map(Number.prototype.valueOf,0),h=Object.keys(n[0]),a=[],p=0;p<h.length;p++)h[p].startsWith("key")||a.push(h[p]);for(var D=0;A>D;D++){for(var f={},p=0;p<a.length;p++)f[a[p]]=0;for(var q=0;b>q;q++)f["key"+q]=R[q];r.push(f);for(var q=b-1;q>=0&&(R[q]+=1,!(R[q]<E[q]));q--)R[q]=0}for(var s=0;t>s;s++){for(var C=0,q=0;b>q;q++)C+=n[s]["key"+q]*N[q];r[C]=n[s]}return r}}return n}function d(n,r){r=v(n,r);var t=r.length;if(G)return r;for(var u=0;u<n.length;u++)if(null!==n[u]){var l=n[u].binBounds,i=n[u].numBins;x&&W.length>0&&(l=W[u]);var o="key"+u.toString(),a="date"==e(l[u]);if(a)for(var s=(l[1].getTime()-l[0].getTime())/i,f=l[0].getTime(),c=0;t>c;++c)r[c][o]=new Date(r[c][o]*s+f);else for(var s=(l[1]-l[0])/i,c=0;t>c;++c)r[c][o]=r[c][o]*s+l[0]}return r}function y(e){return ee=e,k}function p(){return ee=null,k}function h(e){var n=$.extend([],w);n.length||(n=null);var r=l(n);r+=" ORDER BY ";for(var t=0;t<J.length;t++)t>0&&(r+=","),r+="key"+t.toString();var u=!!e,i=null;return i=n?{eliminateNullRows:Z,renderSpec:null,postProcessors:[d.bind(this,n)],queryId:U}:{eliminateNullRows:Z,renderSpec:null,postProcessors:null,queryId:U},u?void H.queryAsync(r,i,e):H.query(r,i)}function S(e,n,r,t){var u=l(null);if(u+=" ORDER BY ",ee)u+=ee+" DESC";else{for(var i=F.split(","),o=i.length,a=0;o-1>a;a++)u+=i[a]+" DESC,";u+=i[o-1]+" DESC"}e!=1/0&&(u+=" LIMIT "+e),void 0!==n&&(u+=" OFFSET "+n);var s=!!t,f={eliminateNullRows:Z,renderSpec:r,postProcessors:null,queryId:U};return s?void H.queryAsync(u,f,t):H.query(u,f)}function A(e,n,r,t){var u=l(null);if(u+=" ORDER BY ",ee)u+=ee;else{for(var i=F.split(","),o=i.length,a=0;o-1>a;a++)u+=i[a]+",";u+=i[o-1]}e!=1/0&&(u+=" LIMIT "+e),void 0!==n&&(u+=" OFFSET "+n);var s=!!t,f={eliminateNullRows:Z,renderSpec:r,postProcessors:null,queryId:U};return s?void H.queryAsync(u,f,t):H.query(u,f)}function E(){return q([{expression:"*",agg_mode:"count",name:"val"}]),k}function T(e){return q([{expression:e,agg_mode:"sum",name:"val"}]),k}function b(e){return q([{expression:e,agg_mode:"avg",name:"val"}]),k}function R(e){return q([{expression:e,agg_mode:"min",name:"val"}]),k}function D(e){return q([{expression:e,agg_mode:"max",name:"val"}]),k}function q(e){B=e,I="",F="";for(var n=e.length,r=0;n>r;r++){if(r>0&&(I+=",",F+=","),r==Y&&null!=g&&g!=U&&""!=c[g])I+=" AVG(CASE WHEN "+c[g]+" THEN 1 ELSE 0 END)";else{var t=e[r].agg_mode.toUpperCase();I+="COUNT"==t?e[r].filter?"COUNT(CASE WHEN "+e[r].filter+" THEN 1 END)":"COUNT(*)":e[r].filter?t+"(CASE WHEN "+e[r].filter+" THEN "+e[r].expression+" END)":t+"("+e[r].expression+")"}I+=" AS "+e[r].name,F+=e[r].name}return k}function C(e){return M=e,k}function O(e){for(var n="SELECT ",t=0;t<J.length;t++)t>0&&(n+=","),n+="COUNT(DISTINCT "+J[t]+") AS n",Q&&(n+=t.toString());if(n+=" FROM "+f,!e){var u=jquery.extend([],w);u.length||(u=null);var l=r(u);""!=l&&(n+=" WHERE "+l)}if(Q){for(var i=m.query(n)[0],o=[],t=0;t<J.length;t++){var a="n"+t.toString();o.push(i[a])}return o}return m.query(n)[0].n}var k={order:y,orderNatural:p,top:S,topAsync:S,bottom:A,bottomAsync:A,all:h,allAsync:h,binParams:a,setBinParams:a,numBins:o,truncDate:s,reduceCount:E,reduceSum:T,reduceAvg:b,reduceMin:R,reduceMax:D,reduce:q,reduceMulti:q,setBoundByFilter:i,setTargetSlot:function(e){Y=e},getTargetSlot:function(){return Y},having:C,size:O,setEliminateNull:function(e){return Z=e,k},binByTimeUnit:function(e){return arguments.length?(G=e,k):G},actualTimeBin:function(){var e=$.extend([],w);if(e.length||(e=null),"auto"===G&&null!==e)for(var n=0;n<J.length;n++){var r=x&&W.length>0?W[n]:e[n].binBounds;K=u([r[0].getTime(),r[1].getTime()],e[n].numBins)}return K},writeFilter:r},I=null,B=null,F=null,M=null,w=null,x=!1,P=null,H=n(m),L=null,Y=0,G=null,X=!0,K=null,Z=!0,ee=null;return _.push(k),E()}function w(){c[U]=null,y[U]=null}var x={type:"dimension",order:t,orderNatural:u,filter:E,filterExact:T,filterRange:D,filterAll:C,filterMulti:q,filterLike:b,filterILike:R,getFilter:S,getFilterString:A,projectOn:p,getProjectOn:function(){return L},projectOnAllDimensions:h,getResultSet:function(){return G},samplingRatio:k,top:I,topAsync:I,bottom:B,bottomAsync:B,group:M,groupAll:o,toggleTarget:i,removeTarget:a,allowTargeted:l,isTargeting:d,dispose:w,remove:w,value:function(){return J},setDrillDownFilter:function(e){return z=e,x}},P=null,j=!0,U=c.length,_=[],H=null;c.push("");var L=[],Y=!1,W=[],G=null,V=[],z=!1,X=n(m),J=[],K=null,k=null,Q=Array.isArray(r);Q?J=r:null!==r&&(J=[r]),J.length>0&&(K="");for(var Z=0;Z<J.length;Z++)0!=Z&&(K+=", "),K+=J[Z];y.push(K);for(var ee=0;ee<J.length;ee++)J[ee]in v?V[ee]=v[J[ee]].is_array:V[ee]=!1;return x}function o(){function e(){for(var e="",n=0,r=0;r<c.length;r++)c[r]&&""!=c[r]&&(n>0&&(e+=" AND "),n++,e+=c[r]);return e}function r(n){var r="SELECT "+y+" FROM "+f;if(!n){var t=e();""!=t&&(r+=" WHERE "+t)}return r}function t(){return y="COUNT(*) as val",d}function u(e){return y="SUM("+e+") as val",d}function l(e){return y="AVG("+e+") as val",d}function i(e){return y="MIN("+e+") as val",d}function o(e){return y="MAX("+e+") as val",d}function a(e){y="";for(var n=e.length,r=0;n>r;r++){r>0&&(y+=",");var t=e[r].agg_mode.toUpperCase();y+="COUNT"==t?"COUNT(*)":t+"("+e[r].expression+")",y+=" AS "+e[r].name}return d}function s(e){var n=r(e),t={eliminateNullRows:!1,renderSpec:null,postProcessors:[function(e){return e[0].val}],queryId:-1};return p.query(n,t)}function g(e){var n=r(),t={eliminateNullRows:!1,renderSpec:null,postProcessors:[function(e){return e[0].val}],queryId:-1};p.queryAsync(n,t,e)}function v(e){var n=r(e),t={eliminateNullRows:!1,renderSpec:null,postProcessors:[function(e){return e[0]}],queryId:-1};return p.query(n,t)}var d={reduceCount:t,reduceSum:u,reduceAvg:l,reduceMin:i,reduceMax:o,reduce:a,reduceMulti:a,value:s,valueAsync:g,values:v},y=null,p=n(m);return t()}function a(){var e="SELECT COUNT(*) as n FROM "+f,n={eliminateNullRows:!1,renderSpec:null,postProcessors:[function(e){return e[0].n}]};return p.query(e,n)}var s={type:"crossfilter",setData:r,filter:l,getColumns:t,dimension:i,groupAll:o,size:a,getFilter:function(){return c},getFilterString:u,getDimensions:function(){return y},getTable:function(){return f},getTableLabel:function(){return d}},f=null,c=[],g=null,v=null,d=null,m=null,y=[],p=null,h={undefined:"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error"},S=Object.prototype.toString;return 3==arguments.length?r(arguments[0],arguments[1],arguments[2]):s}r.version="1.3.11",e.resultCache=n,e.crossfilter=r}("undefined"!=typeof exports&&exports||this);